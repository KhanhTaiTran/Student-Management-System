<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="#{hero.title}">Student Management System</title>

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <link rel="stylesheet" th:href="@{/css/index.css}" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <div class="container">
        <a class="navbar-brand" href="/">
          <i class="fa-solid fa-graduation-cap me-2"></i
          ><span th:text="#{nav.brand}">SMS System</span>
        </a>
        <button
          title="nav-btn"
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link active" href="/" th:text="#{nav.home}">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#features" th:text="#{nav.features}"
                >Features</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/contact" th:text="#{nav.contact}"
                >Contact</a
              >
            </li>

            <li class="nav-item dropdown ms-3">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                id="navbarDropdown"
                role="button"
                data-bs-toggle="dropdown"
              >
                <i class="fa-solid fa-globe"></i> Language
              </a>
              <ul
                class="dropdown-menu dropdown-menu-end"
                aria-labelledby="navbarDropdown"
              >
                <li><a class="dropdown-item" href="?lang=en">ðŸ‡ºðŸ‡¸ English</a></li>
                <li>
                  <a class="dropdown-item" href="?lang=vi">ðŸ‡»ðŸ‡³ Tiáº¿ng Viá»‡t</a>
                </li>
              </ul>
            </li>

            <li class="nav-item ms-3">
              <button
                class="btn btn-primary"
                data-bs-toggle="modal"
                data-bs-target="#loginModal"
                th:text="#{nav.login}"
              >
                Login
              </button>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <section class="hero-section text-center">
      <div class="container">
        <h1 class="display-4 fw-bold mb-4" th:text="#{hero.title}">Title</h1>
        <p class="lead mb-4" th:text="#{hero.subtitle}">Subtitle</p>
        <div class="d-flex justify-content-center gap-3">
          <button
            class="btn btn-light btn-lg px-5 fw-bold text-primary"
            data-bs-toggle="modal"
            data-bs-target="#loginModal"
            th:text="#{nav.login}"
          >
            Start
          </button>
          <a
            href="#features"
            class="btn btn-outline-light btn-lg px-5"
            th:text="#{hero.btn.learn}"
            >Learn More</a
          >
        </div>
      </div>
    </section>

    <section id="features" class="py-5">
      <div class="container">
        <div class="text-center mb-5">
          <h2 class="fw-bold" th:text="#{feat.title}">User Roles</h2>
          <p class="text-muted" th:text="#{feat.subtitle}">Description</p>
        </div>
        <div class="row g-4">
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm p-3">
              <div class="card-body text-center">
                <div class="feature-icon">
                  <i class="fa-solid fa-user-shield"></i>
                </div>
                <h4 class="card-title" th:text="#{role.admin}">Admin</h4>
                <p class="card-text" th:text="#{role.admin.desc}">Desc</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm p-3">
              <div class="card-body text-center">
                <div class="feature-icon">
                  <i class="fa-solid fa-chalkboard-user"></i>
                </div>
                <h4 class="card-title" th:text="#{role.teacher}">Teacher</h4>
                <p class="card-text" th:text="#{role.teacher.desc}">Desc</p>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm p-3">
              <div class="card-body text-center">
                <div class="feature-icon">
                  <i class="fa-solid fa-user-graduate"></i>
                </div>
                <h4 class="card-title" th:text="#{role.student}">Student</h4>
                <p class="card-text" th:text="#{role.student.desc}">Desc</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!--Modal Login-->
    <div class="modal fade" id="loginModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div
          class="modal-content border-0 shadow-lg overflow-hidden"
          style="border-radius: 15px"
        >
          <div
            class="modal-header text-white border-0"
            style="
              background: linear-gradient(135deg, #0d6efd 0%, #0dcaf0 100%);
            "
          >
            <h5 class="modal-title fw-bold">
              <i class="fa-solid fa-graduation-cap me-2"></i>
              <span th:text="#{login.title}">Welcome Back</span>
            </h5>
            <button
              type="button"
              class="btn-close btn-close-white"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>

          <div class="modal-body p-4 bg-light">
            <div
              id="alertBox"
              class="alert alert-danger d-none"
              role="alert"
            ></div>

            <form id="loginForm">
              <div class="mb-3">
                <label
                  class="form-label text-muted small fw-bold"
                  th:text="#{login.username}"
                  >Username</label
                >
                <div class="input-group">
                  <span class="input-group-text bg-white border-end-0"
                    ><i class="fa-solid fa-user text-muted"></i
                  ></span>
                  <input
                    type="text"
                    class="form-control border-start-0 ps-0"
                    id="username"
                    required
                  />
                </div>
              </div>

              <div class="mb-4">
                <label
                  class="form-label text-muted small fw-bold"
                  th:text="#{login.password}"
                  >Password</label
                >
                <div class="input-group">
                  <span class="input-group-text bg-white border-end-0"
                    ><i class="fa-solid fa-lock text-muted"></i
                  ></span>
                  <input
                    type="password"
                    class="form-control border-start-0 ps-0"
                    id="password"
                    required
                  />
                </div>
              </div>

              <div class="d-grid">
                <button
                  type="submit"
                  class="btn btn-primary btn-lg fw-bold"
                  id="btnLogin"
                >
                  <span th:text="#{login.btn}">Sign In</span>
                </button>
              </div>
            </form>

            <div class="text-center mt-3">
              <a
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#forgotModal"
                class="text-decoration-none small"
                th:text="#{login.forgot}"
              >
                Forgot Password?
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--Forgot modal-->
    <div class="modal fade" id="forgotModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content border-0 shadow-lg">
          <div class="modal-header bg-warning text-dark border-0">
            <h5 class="modal-title fw-bold">
              <i class="fa-solid fa-key me-2"></i
              ><span th:text="#{forgot.title}">Forgot Password</span>
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body p-4">
            <div id="forgotAlert" class="alert d-none"></div>

            <p class="text-muted small" th:text="#{forgot.instruction}">
              Input your school email
            </p>

            <form id="forgotForm">
              <div class="mb-3">
                <input
                  type="email"
                  class="form-control"
                  id="forgotEmail"
                  th:placeholder="#{forgot.email.placeholder}"
                  required
                />
              </div>
              <button type="submit" class="btn btn-warning w-100 fw-bold">
                <span th:text="#{forgot.btn}">Send Request</span>
              </button>
            </form>

            <div class="text-center mt-3">
              <a
                href="#"
                data-bs-toggle="modal"
                data-bs-target="#loginModal"
                class="small text-decoration-none"
                th:text="#{forgot.back}"
              >
                Go to Login
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer class="bg-dark text-white py-4 text-center mt-auto">
      <div class="container">
        <p class="mb-0" th:text="#{footer.text}">&copy; 2025</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script th:src="@{/js/login.js}"></script>
    <script th:src="@{/js/forgotPassword.js}"></script>

    <script th:inline="javascript">
      const messages = {
        loading: /*[[#{login.loading}]]*/ "Loading...",
        success: /*[[#{login.success}]]*/ "Success!",
        failed: /*[[#{login.failed}]]*/ "Failed!",
        btnText: /*[[#{login.btn}]]*/ "Login",
      };

      const forgotMsgs = {
        btnLoading: '<i class="fa-solid fa-spinner fa-spin"></i>',
        btnDefault: /*[[#{forgot.btn}]]*/ "Send",
        success: /*[[#{forgot.success}]]*/ "Sent!",
        failed: /*[[#{forgot.failed}]]*/ "Email not found",
        error: /*[[#{forgot.error}]]*/ "Error",
      };

      // handle login
      const loginForm = document.getElementById("loginForm");
      if (loginForm) {
        loginForm.addEventListener("submit", function (e) {
          handleLogin(e, messages);
        });
      }

      // handle Forgot Password
      const forgotForm = document.getElementById("forgotForm");
      if (forgotForm) {
        forgotForm.addEventListener("submit", async function (e) {
          e.preventDefault();
          const email = document.getElementById("forgotEmail").value;
          const alertBox = document.getElementById("forgotAlert");
          const btn = this.querySelector("button");

          // Loading UI
          btn.disabled = true;
          btn.innerHTML = forgotMsgs.btnLoading;
          alertBox.classList.add("d-none");

          try {
            // call API Backend
            const res = await fetch("/api/auth/forgot-password", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ email: email }),
            });

            if (res.ok) {
              alertBox.className = "alert alert-success";
              alertBox.innerText = forgotMsgs.success;
              alertBox.classList.remove("d-none");
            } else {
              alertBox.className = "alert alert-danger";
              alertBox.innerText = forgotMsgs.failed;
              alertBox.classList.remove("d-none");
            }
          } catch (err) {
            alertBox.className = "alert alert-danger";
            alertBox.innerText = forgotMsgs.error;
            alertBox.classList.remove("d-none");
          } finally {
            btn.disabled = false;
            btn.innerHTML = forgotMsgs.btnDefault;
          }
        });
      }
    </script>
  </body>
</html>
