<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <title>My Classes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link rel="stylesheet" th:href="@{/css/admin.css}"/>
</head>

<body>
<div class="container-fluid">
  <div class="row">
    <!-- SIDEBAR -->
    <nav th:replace="fragments/sidebar :: sidebar"></nav>

    <!-- MAIN -->
    <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4 mt-4">

      <div class="d-flex justify-content-between align-items-center mb-3 border-bottom">
        <h2 class="text-primary">
          <i class="fa-solid fa-chalkboard-user"></i> My Classes
        </h2>
      </div>

      <div class="table-responsive shadow-sm rounded">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-dark">
            <tr>
              <th>#</th>
              <th>Class Name</th>
              <th>Course</th>
              <th>Semester</th>
              <th>Room</th>
              <th class="text-center">Students</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody id="classTableBody"></tbody>
        </table>
      </div>

    </main>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const token = localStorage.getItem("accessToken");

  fetch("/api/teacher/classes", {
    headers: { Authorization: "Bearer " + token }
  })
  .then(res => res.json())
  .then(classes => {
    const tbody = document.getElementById("classTableBody");
    tbody.innerHTML = "";

    if (classes.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="7" class="text-center text-muted py-4">
            You have not been assigned to any class yet.
          </td>
        </tr>`;
      return;
    }

    classes.forEach((c, index) => {
      tbody.innerHTML += `
        <tr>
          <td>${index + 1}</td>
          <td class="fw-bold text-primary">${c.className}</td>
          <td>${c.courseName}</td>
          <td>${c.semester ?? "-"}</td>
          <td>${c.room ?? "-"}</td>
          <td class="text-center">
            <span class="badge bg-info text-dark rounded-pill">
              <i class="fa-solid fa-users"></i> ${c.studentCount}
            </span>
          </td>
          <td class="text-center">
            <div class="btn-group" role="group">
              
              <!-- ✅ GIỮ NÚT GRADES -->
              <a href="/teacher/grades/${c.classId}"
                 class="btn btn-sm btn-outline-primary"
                 title="Enter Grades">
                <i class="fa-solid fa-pen-to-square"></i> Grades
              </a>

              <!-- ✅ ATTENDANCE + GHI NHỚ CLASS -->
              <a href="/teacher/attendance/${c.classId}"
                 class="btn btn-sm btn-outline-success"
                 title="Take Attendance"
                 onclick="rememberClass(${c.classId})">
                <i class="fa-solid fa-check-double"></i> Attendance
              </a>

            </div>
          </td>
        </tr>
      `;
    });
  })
  .catch(err => {
    console.error(err);
    document.getElementById("classTableBody").innerHTML = `
      <tr>
        <td colspan="7" class="text-center text-danger py-4">
          Error loading classes.
        </td>
      </tr>`;
  });
});

function rememberClass(classId) {
  localStorage.setItem("lastAttendanceClassId", classId);
}
</script>

</body>
</html>
